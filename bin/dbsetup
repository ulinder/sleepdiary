#!/usr/bin/env node
var db = require('../db.js');

db.serialize( () => {
  console.log("> Dropping previous tables and recreating [users, posts] <");
  db.run(`DROP TABLE IF EXISTS users`,
    (err)=>{
    if(err) console.log(err, this.lastID);
    });

  db.run(`DROP TABLE IF EXISTS posts`,
    (err)=>{
    if(err)  console.log(err, this.lastID);
    });

  db.run(`CREATE TABLE IF NOT EXISTS users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    hash TEXT,
    mode INTEGER DEAFULT 0,
    version INTEGER DEAFULT 0,
    windown TEXT DEFAULT '23:00',
    winup TEXT DEFAULT '08:00' 
    )`,

    (err)=>{
    if(err)  console.log(err, this.lastID);
    });

  db.run(`CREATE TABLE IF NOT EXISTS posts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER,
    down INTEGER, 
    up INTEGER,
    awake INTEGER, 
    rate INTEGER,
    status INTEGER,
    windown TEXT,
    winup TEXT,
    t TIMESTAMP
    DEFAULT CURRENT_TIMESTAMP
    )`,
    (err)=>{
    if(err)  console.log(err, this.lastID);
    });

  db.close(); 
  console.log("\n --- Dbsetup done ---");
});

